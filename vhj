| Source_DB | Source_Table | Source_Field                                 | Target_Table | Business Logic                                                                                                                                                                                                                                                                                                                                                       |
| --------- | ------------ | -------------------------------------------- | ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| FILE      | Hierarchy_In | gfcid                                        | LR_File      | The hierarchy is flattened so each child becomes its own row, adjusting parenting so `load_gfcid = child_gfcid` to preserve lineage. Pseudo: `out.load_gfcid := in.agg_hierarchy[index].child_gfcid;` Rows with null `parent_gfcid` are skipped, and valid `gfcid` values are written to the target.                                                                 |
| FILE      | Hierarchy_In | id_type                                      | LR_File      | Value carried unchanged. Rows without `parent_gfcid` are excluded. Write `id_type` directly to the output.                                                                                                                                                                                                                                                           |
| FILE      | Hierarchy_In | batch_dt                                     | LR_File      | Field propagated as-is from input to output. Only rows having a valid parent-child link are written.                                                                                                                                                                                                                                                                 |
| FILE      | Hierarchy_In | client_type                                  | LR_File      | Pass through `client_type`. Filter out records lacking a parent link, then write the value to the output file.                                                                                                                                                                                                                                                       |
| FILE      | Hierarchy_In | month                                        | LR_File      | Copy `month` without modification. Keep rows that have valid parent references and write to target.                                                                                                                                                                                                                                                                  |
| FILE      | Hierarchy_In | year                                         | LR_File      | Pass through `year`. Keep only rows linked to valid parents and write to output.                                                                                                                                                                                                                                                                                     |
| FILE      | Hierarchy_In | country                                      | LR_File      | Pass through `country`. Exclude orphan rows. Write `country` to target.                                                                                                                                                                                                                                                                                              |
| FILE      | Hierarchy_In | agg_hierarchy[index].agg                     | LR_File      | Flatten the array and handle special parent-child cases: if the last element’s `parent_gfcid` is null and the current index is second-last, take the next element’s value; otherwise take current. Pseudo: `out.agg := if(switch_flag='Y') next.agg else curr.agg;` This ensures a child inherits parent data where needed. Write the resulting `agg` to the target. |
| FILE      | Hierarchy_In | agg_hierarchy[index].cntry_code              | LR_File      | During flattening, derive `cntry_code` from current hierarchy element, or inherit from the next element in the special parenting case. This propagates the parent’s country code downward. Write only for valid parent-linked rows.                                                                                                                                  |
| FILE      | Hierarchy_In | agg_hierarchy[index].cntry_appx_id           | LR_File      | Normalize array while preserving parent-child structure; derive `cntry_appx_id` from current or next element depending on `switch_flag`. Ensures consistent appendix identifier inheritance.                                                                                                                                                                         |
| FILE      | Hierarchy_In | agg_hierarchy[index].country_appx_state      | LR_File      | Flatten array; inherit `country_appx_state` from next element when parent-child adjustment applies. Rows missing parent references are skipped.                                                                                                                                                                                                                      |
| FILE      | Hierarchy_In | agg_hierarchy[index].country_appx_status     | LR_File      | During normalization, derive `country_appx_status` from current or next hierarchy record depending on `switch_flag`. Keeps consistent parent-child status propagation.                                                                                                                                                                                               |
| FILE      | Hierarchy_In | agg_hierarchy[index].citi_service_cntry_code | LR_File      | Flatten array with parenting adjustment; assign `citi_service_cntry_code` from next element when `switch_flag='Y'` (UAT fix #28454 applied). This ensures correct service-country propagation down the hierarchy.                                                                                                                                                    |
| FILE      | Hierarchy_In | switch_flag (derived)                        | LR_File      | Derived during hierarchy flattening: `switch_flag = if(is_null(last.parent_gfcid) and length>1 and index=length-2) 'Y' else 'N'`. Used to decide when a child record inherits parent values during parenting adjustment (`load_gfcid = child_gfcid`). Write for traceability in debugging or audit.                                                                  |
