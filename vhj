OSource files
1) DBC template (text)

Path: /home/yn42261/private_sand/GFTS/KYC/etl_interfaces/db/kyc_stg1_rgn_ld.dbc

Content model: plain-text lines. The transform expects at least these keys at the start of a line:

db_name: …

user: …

encrypted_password: …

(All other lines are carried through unchanged.)

2) Regional configuration catalog (CSV)

Path: /home/yn42261/sand/GFTS/KYC/kyc_db_common/kyc_config.csv

Content model: one row per PHASE (region/environment). The code uses a case-insensitive match on the phase string and then splits that row by commas (quote-aware).

Fields actually consumed by the mapping (by index in the parsed vector):

PHASE – the row selector (e.g., DEV-APAC, DEV-NAM, DEV-IDN) – used to find the row.

db_name – vector position 2 (0-based in code): database/service name for that region.

user – vector position 5: login/user for that region.

encrypted_password – vector position 6: encrypted password string for that user.

(Other columns like db_version, db_home, db_nodes, tns_admin may exist in the row but are not used by the current logic.)

Note: Positions above are derived from the PARAM_VEC[2], [5], [6] references in your Reformat.

Business logic (sentence form)

Create_Data emits a single dummy integer record purely to drive the flow.

Replicate sends this record to three identical regional branches: ASPAC, NAM, and IDN.

In each branch’s Reformat:

The component reads the DBC template file (kyc_stg1_rgn_ld.dbc) into a list of lines.

It sets a region-specific PHASE constant: DEV-APAC, DEV-NAM, or DEV-IDN.

It reads the CSV catalog (kyc_config.csv), locates the row whose phase matches the branch’s PHASE (string upper-cased for matching), and splits that row by commas (respecting quotes).

From that split row it extracts:

db_name from element 2,

user from element 5,

encrypted_password from element 6.

It validates that each of the three values exists; if any is missing, it raises a configuration error (via fail_if_error/force_error) and the branch stops.

It walks the template lines and replaces:

any line that starts with db_name → db_name: <db_name>

any line that starts with user → user: <user>

any line that starts with encrypted_password → encrypted_password: <encrypted_password>

all other lines are passed through unchanged.

Finally, it rejoins the modified lines with newlines to produce the final DBC text for that region.

Each branch’s …_dbc File component writes the final DBC to the region-specific path with mode 0666.

ASPAC → $APAC_DBC (file typically named aspac.dbc)

NAM → $NAM_DBC (file typically named nam.dbc)

IDN → $IDN_DBC (file typically named idn.dbc)

Targets (outputs)
Region	Target file variable	What’s in the file
ASPAC	$APAC_DBC (e.g., aspac.dbc)	The template with db_name, user, encrypted_password replaced by APAC values from kyc_config.csv.
NAM	$NAM_DBC (e.g., nam.dbc)	The template with those three keys replaced by NAM values.
IDN	$IDN_DBC (e.g., idn.dbc)	The template with those three keys replaced by IDN values.

All other template lines are preserved verbatim; only the three keys are substituted.

One-line overview

The job reads a shared DBC template and a regional CSV catalog, picks the row for the current region, substitutes db_name, user, and encrypted_password into the template, and writes the completed .dbc for ASPAC, NAM, and IDN respectively.
