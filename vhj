| source_db        | source_table              | source_fields                               | target_table | business_logic                                                                                                                                                                                                                                                                                              |
| ---------------- | ------------------------- | ------------------------------------------- | ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **KYC_GBL_MAIN** | **KYC_ID_XREF XREF**      | **XREF.ID**                                 | **CORE_LKP** | Extract GFCID-level KYC relationships from `KYC_ID_XREF` joined to `KYC_MAIN`. Apply filter `!lookup_match("BRK DEALER CNTRY LKP", citi_service_cntry_code)` to exclude broker/dealer countries. After filtering, partition and dedup on `{primary_client_id, kycid}` keeping the first occurrence per key. |
| **KYC_GBL_MAIN** | **KYC_ID_XREF XREF**      | **XREF.KYCID**                              | **CORE_LKP** | Join `XREF.KYCID = M.KYCID` ensuring only records where `XREF.ID_TYPE = 'GFCID'` are selected. Participates in the partition and sort key `{primary_client_id; kycid; core_component_state}` to maintain uniqueness.                                                                                        |
| **KYC_GBL_MAIN** | **KYC_ID_XREF XREF**      | **XREF.CORE_COMPONENT_STATE**               | **CORE_LKP** | Used in sorting and deduplication sequence `{primary_client_id; kycid; core_component_state}`. Ensures consistent state alignment for deduped GFCIDs.                                                                                                                                                       |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.PRIMARY_CLIENT_ID**                     | **CORE_LKP** | Passed through Reformat (`Ref-2`) as `primary_client_id`. Used as one of the partition and deduplication keys `{primary_client_id; kycid}`.                                                                                                                                                                 |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.STATUS**                                | **CORE_LKP** | Determines record activeness. Logic: “Get where CORE is 'ACTIVE', if not then 'IN_PROGRESS'”. Used for validation of CORE/CA status checks.                                                                                                                                                                 |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.PRIMARY_ID_TYPE**                       | **CORE_LKP** | Only includes records with `M.PRIMARY_ID_TYPE = 'GFCID'` as per input SQL filter.                                                                                                                                                                                                                           |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.CLIENT_TYPE**                           | **CORE_LKP** | Carried through pipeline unchanged. Participates in final output as an informational field.                                                                                                                                                                                                                 |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.CLIENT_CATEGORY**                       | **CORE_LKP** | Passed as-is; no transformation, included in final lookup file.                                                                                                                                                                                                                                             |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.PRIM_OWNER_BUSINESS_UNIT**              | **CORE_LKP** | Joined to `KYC_BUSINESS_UNIT` table to enrich with business unit metadata; appears as `BU` in input.                                                                                                                                                                                                        |
| **KYC_GBL_MAIN** | **KYC_BUSINESS_UNIT U**   | **U.LINE_OF_BUSINESS AS LOB**               | **CORE_LKP** | Enriched from Business Unit table: join condition `M.PRIM_OWNER_BUSINESS_UNIT = U.BUSINESS_UNIT_CODE`.                                                                                                                                                                                                      |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.DOMICILE_CNTRY_CODE**                   | **CORE_LKP** | Passed through; country-of-domicile attribute for the entity.                                                                                                                                                                                                                                               |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.CITI_SERVICE_CNTRY_CODE**               | **CORE_LKP** | Core filter criterion: `!lookup_match("BRK DEALER CNTRY LKP", citi_service_cntry_code)` ensures exclusion of broker/dealer countries before further processing.                                                                                                                                             |
| **KYC_GBL_MAIN** | **KYC_MAIN M**            | **M.PRIM_OWNER_SOEID**                      | **CORE_LKP** | Joined to `KYC_USER` to enrich with owner’s full name; ensures traceability to responsible person.                                                                                                                                                                                                          |
| **KYC_GBL_MAIN** | **KYC_USER S**            | **S.EMPLOYEE_FULL_NAME AS PRIM_OWNER_NAME** | **CORE_LKP** | Left join on `S.SOEID = M.PRIM_OWNER_SOEID` to fetch the corresponding employee name.                                                                                                                                                                                                                       |
| **KYC_RGN_STG**  | **GIW_HIERARCHY_RAW GHR** | **GHR.COUNTRY**                             | **CORE_LKP** | Provides regional context for `XREF.ID = GHR.GFCID`. Used to validate service country and to ensure GFCID activity within recent timeframe (≤730 days).                                                                                                                                                     |
