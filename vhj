| Source_DB    | Source_Table (alias)          | Source_Field            | Target_Table      | Target_Column          | Business_Logic (joins, filters, PBK/Sort/Dedup, transforms all inlined)                                                                                                                                                                                                                                                                                                                                                      |
| ------------ | ----------------------------- | ----------------------- | ----------------- | ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| KYC_GBL_MAIN | CIS_MARKETED_RELATIONSHIP (a) | **GFCID**               | CIS_Table_extract | **gfcid**              | Use as primary key for the CIS stream. Stream hygiene before join: **PBK by `{gfcid}` → Sort by `{gfcid}` → Dedup on `{gfcid}` keep first**. This is the **left input** to an **Inner Join (sorted-input=true)** on `{gfcid}` with EXCP stream (where EXCP.ID is treated as gfcid).                                                                                                                                          |
| KYC_GBL_MAIN | CIS_MARKETED_RELATIONSHIP (a) | **LEVEL3_ID**           | CIS_Table_extract | *(feeds derivation)*   | Passed into subquery predicate `c.MARKETING_ENTITY_ID = a.LEVEL3_ID` to resolve owner text. No direct target column.                                                                                                                                                                                                                                                                                                         |
| KYC_GBL_MAIN | CIS_TARGET_MARKET_BUYERS (c)  | **CLIENT_OWNER**        | CIS_Table_extract | *(feeds derivation)*   | Used in subquery join to CIS_ATTRIBUTE_DATA via `m.ATTRIBUTE_VALUE = c.CLIENT_OWNER`.                                                                                                                                                                                                                                                                                                                                        |
| KYC_GBL_MAIN | CIS_TARGET_MARKET_BUYERS (c)  | **MARKETING_ENTITY_ID** | CIS_Table_extract | *(feeds derivation)*   | Must equal `a.LEVEL3_ID` (see LEVEL3_ID row).                                                                                                                                                                                                                                                                                                                                                                                |
| KYC_GBL_MAIN | CIS_ATTRIBUTE_DATA (m)        | **ATTRIBUTE_NAME**      | CIS_Table_extract | *(feeds derivation)*   | Filtered as `m.ATTRIBUTE_NAME = 'CLIENT OWNER'`.                                                                                                                                                                                                                                                                                                                                                                             |
| KYC_GBL_MAIN | CIS_ATTRIBUTE_DATA (m)        | **ATTRIBUTE_VALUE**     | CIS_Table_extract | *(feeds derivation)*   | Must equal `c.CLIENT_OWNER`.                                                                                                                                                                                                                                                                                                                                                                                                 |
| KYC_GBL_MAIN | CIS_ATTRIBUTE_DATA (m)        | **LONG_DESC**           | CIS_Table_extract | **business_owner**     | Derived **L3_CLIENT_OWNER** as: `(select m.LONG_DESC from CIS_TARGET_MARKET_BUYERS c, CIS_ATTRIBUTE_DATA m where m.ATTRIBUTE_NAME='CLIENT OWNER' and m.ATTRIBUTE_VALUE=c.CLIENT_OWNER and c.MARKETING_ENTITY_ID=a.LEVEL3_ID)`. Then in **Reformat-2**: `business_owner = UPPER(L3_CLIENT_OWNER)`. (Note: any constant preset in the graph is overridden by `out.* :: in.*`; effective result is **UPPER(L3_CLIENT_OWNER)**.) |
| KYC_RGN_STG  | GIW_HIERARCHY_RAW (GHR)       | **GFCID**               | CIS_Table_extract | *(record eligibility)* | CIS read SQL restricts to `a.gfcid IN (SELECT GFCID FROM KYC_RGN_STG.GIW_HIERARCHY_RAW)`. No direct target mapping; it’s a **read-time filter** for the CIS stream.                                                                                                                                                                                                                                                          |


| Source_DB                             | Source_Table              | Source_Field             | Target_Table      | Target_Column          | Business_Logic (joins, filters, PBK/Sort/Dedup, transforms all inlined)                                                                                                                                                                                                                       |
| ------------------------------------- | ------------------------- | ------------------------ | ----------------- | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| KYC_GBL_MAIN                          | GIW_BATCH_EXCP_LOG (EXCP) | **ID**                   | CIS_Table_extract | **gfcid (join key)**   | Treat **EXCP.ID as gfcid** for joining to CIS. **Input filter at read:** `EXCEPTION_CD IN ('C','N')`. Stream hygiene before join: **PBK by `{id}` → Sort by `{id}` → Dedup Sorted on `{id}` keep first**. Provides the **right input** to an **Inner Join (sorted-input=true)** on `{gfcid}`. |
| KYC_GBL_MAIN                          | GIW_BATCH_EXCP_LOG (EXCP) | **KYC_LINE_OF_BUSINESS** | CIS_Table_extract | **line_of_business**   | After the EXCP stream filter/sort/dedup above, pass through on join match `{gfcid}` to populate **line_of_business**.                                                                                                                                                                         |
| KYC_GBL_MAIN                          | GIW_BATCH_EXCP_LOG (EXCP) | **GIW_BUSINESS_UNIT**    | CIS_Table_extract | **business_unit**      | Same EXCP stream; join on `{gfcid}`; pass through to **business_unit**.                                                                                                                                                                                                                       |
| KYC_GBL_MAIN                          | GIW_BATCH_EXCP_LOG (EXCP) | **KYC_CLIENT_TYPE**      | CIS_Table_extract | **client_type**        | Same EXCP stream; join on `{gfcid}`; pass through to **client_type**.                                                                                                                                                                                                                         |
| KYC_GBL_MAIN                          | GIW_BATCH_EXCP_LOG (EXCP) | **EXCEPTION_CD**         | CIS_Table_extract | *(record eligibility)* | Used only for **read filter** `IN ('C','N')`. No direct target column.                                                                                                                                                                                                                        |
| *(optional—only if reinstated later)* | GIW_BATCH_EXCP_LOG (EXCP) | **CREATE_DT**            | CIS_Table_extract | *(record eligibility)* | If you re-enable the historic window seen in comments, add to EXCP read filter: `CREATE_DT BETWEEN SYSDATE-730 AND SYSDATE`.                                                                                                                                                                  |
