Mapping Name: WorkItem_In_to_TBL

The mapping reads the WorkItem_In source file, reformats and enriches the data through the Ref_WI_In_to_TBL component, and finally writes the transformed records into the LR_File target.

Source

The source file used in this mapping is WorkItem_In, defined using the DML file ~$AI_DML/kyc_interface_giw_hierarchy_trade_pup.dml.
This file contains hierarchical work-item data from the GIW hierarchy process.
The input metadata includes the following key fields:

gfcid – Global Financial Client Identifier.

id_type – Identifier type for the record.

batch_dt – The batch processing date in DD/MM/YYYY format.

client_type – Type of client, represented as a single character.

month – Month code for the record.

year – Year code for the record.

country – Country code.

workitem_req – A structured record that holds detailed work item request information.

The file layout is read using the $WI_OUT_FILE mfile location.

Business Logic (Transformation – Ref_WI_In_to_TBL)

The transformation component Ref_WI_In_to_TBL performs a reformat operation to convert the nested work-item structure into a flat, table-ready format that aligns with the TRADE_PUP_WI_REQ_INTF record type.

The transformation first includes the UUID generator file ~$AI_XFR/genUUID.xfr and defines helper variables for audit and timestamp fields:

CURRENT_DATE = date("YYYYMMDD") now() → Captures the current system date.

LST_UPD_TIME = datetime_to_unixtime(utc_now()) * 100 → Captures the timestamp in milliseconds.

A generic UUID function get_string_unique_key() is available for unique ID generation, though not used directly in this mapping.

During processing, each input record is transformed as follows:

Region Derivation:
The region_initiated field is derived from internal region codes such as NAM, APAC, and MEXICO.
For example, 'NAM' is standardized as 'NA', and 'APAC' becomes 'ASPAC'.
This ensures consistent region representation in the output.

Calendar and Identification Fields:
The mapping transfers basic date attributes directly:

month = in.month

year = in.year

batch_dt = in.batch_dt

batch_id = '202009010053706' (constant value representing the batch run ID)

Client Information:

client_type = in.workitem_req.client_type

client_segment = in.client_type

Audit Columns:
System-level audit information is added to each record:

create_id = 'SYSTEM'

create_dt = CURRENT_DATE

lst_upd_id = 'SYSTEM'

lst_upd_dt = CURRENT_DATE

lst_upd_time = LST_UPD_TIME

Additional default values are set:

ver_num = 0

kyc_shard_num = 3000

Payload Flattening:
The entire nested structure workitem_req.* is copied into the flat output layout using the expression:

out.TRADE_PUP_WI_REQ_INTF.* :1: in.workitem_req.*;


This ensures all subfields inside the work item request are preserved in the target table.

Enrichment:
A new column transacting_gfcid is added and populated with the input field in.gfcid.
This change was introduced as part of enhancement SIO387J.

The overall transformation outputs a fully standardized record aligned with the downstream interface schema.

Target

The target dataset for this mapping is LR_File, defined using the metadata file ~$AI_DML/kyc_interface_giw_main_table.dml.
The data is written in the format of TRADE_PUP_WI_REQ_INTF_type, which matches the transformed output structure.
The file path is configured using $LR_FILE as the dataset reference.

The target contains all flattened work item details, standardized region codes, client and batch identifiers, and audit information.
This LR file acts as the staging table for downstream processing and loading into the GIW Trade Summary tables.

Summary

In summary, the WorkItem_In_to_TBL mapping extracts work item data from the WorkItem_In file, reformats and enriches it with standardized region, audit, and shard details, and writes the transformed records into the LR_File.
The process ensures that all hierarchical structures are flattened, unique identifiers are standardized, and audit information is embedded for traceability.
